"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},Skeleton=function(){function t(e){function n(t){var n=Object.assign({},e.defaults)||{};this.get=function(t){return n[t]||null},this.set=function(){if(2===arguments.length)n[arguments[0]]=arguments[1];else{if(1!==arguments.length)throw new Error("Error on setting a value");var t=arguments[0];for(var e in t)n[e]=t[e]}},this.toJSON=function(){return n};for(var r in t)this.set(r,t[r]);e&&e.init&&e.init.call(this)}if(!(this instanceof t))return new t(e);if(!e||!e.defaults)throw new Error('A "defaults" field must be passed');for(var r in e)"init"!==r&&"defaults"!==r&&(n.prototype[r]=e[r]);return n}function e(t){function n(e){function n(t){"number"==typeof t?r.splice(t,1):r=r.filter(function(e){return e!==t})}var r=[],o=t&&t.model;this.add=function(t){if(!(t instanceof o))throw new Error("A collection must consist of models of same instance");r.push(t)},this.addFirst=function(t){if(!(t instanceof o))throw new Error("A collection must consist of models of same instance");r.unshift(t)},this.removeByFields=function(t){r=r.filter(function(e){for(var n in t)if(e.get(n)!==t[n])return!0;return!1})},this.remove=function(){if(1===arguments.length)n(arguments[0]);else for(var t=0;t<arguments.length;t++)n(arguments[t])},this.removeAll=function(){r=[]},this.models=function(){return r},this.sort=function(t){r.sort(t)},this.filterToJSON=function(t){return this.toJSON().filter(t)},this.toJSON=function(){return r.map(function(t){return t.toJSON()})},this.size=function(){return r.length},t&&t.init&&t.init.call(this)}return this instanceof e?n:new e(t)}function n(t){function r(t,e){if(t){if(!b[t])throw new Error("The type passed is not a possible type");b[t].forEach(function(t){return t(e)})}else b.push.forEach(function(t){return t(e)}),b.remove.forEach(function(t){return t(e)})}function o(t){return(Array.isArray(t)||"object"===("undefined"==typeof t?"undefined":_typeof(t))&&null!==typeof t&&void 0!==("undefined"==typeof t?"undefined":_typeof(t)))&&(t=JSON.stringify(t)),t}function i(t){try{return t=JSON.parse(t)}catch(e){return t}}function u(t,e){t instanceof S||(t=new S(t));var n=t.toJSON();t.set("index",m()),"push"===e?x.add(t):x.addFirst(t),s(n,e),r("push",n)}function s(t,e){if("push"===e)A.innerHTML+=c(l(t),t);else{if("unshift"!==e)throw new Error('unknown method passed to "_updateSingleModelView"');A.innerHTML=c(l(t),t)+A.innerHTML}}function f(t){A.innerHTML=a(t)}function a(t){var e=t||x.toJSON();e.forEach(function(t){return t.index=m()});var n="";return e.forEach(function(t){n+=c(l(t),t)}),n}function c(t,e){var n=w(t),r=n.querySelectorAll("[data-loop]");return r&&r.length?(Array.prototype.slice.call(r).forEach(function(n,r){var o=n.getAttribute("data-loop").trim(),i=e[o];if(!i)throw new Error(o+" attribute does not appear in model");if(!Array.isArray(i))throw new Error(o+"'s value must be an array");var u=p(n),s="";i.forEach(function(t){s+=u.replace(g,function(e,n){return-1!==n.indexOf("|")?h(t,n):d(t,n)})}),t=t.replace(u,s)}),t):t}function l(t){var e=O;return e=e.replace(v,function(e,n){return-1!==n.indexOf("|")?h(t,n):d(t,n)})}function h(t,e){var n=e.split("|"),r=n[0].trim(),o=n[1].trim(),i=d(t,r);if(!i)throw new Error('Please check the expression "'+r+'" you passed in the template');if(E[o])return E[o](i);throw new Error('The filter you are using does not exist. Please use "addFilter" function to create it.')}function d(t,e){if("this"===e)return t;var n=e.split(".");if(1===n.length)return t[e];for(var r=t[n[0].trim()],o=1;o<n.length;o++)r=r[n[o].trim()];return r}function m(){return y++}function p(t){var e=document.createElement("div");return e.appendChild(t),e.innerHTML}function w(t){var e=document.createElement("div");return e.innerHTML=t,e.firstElementChild}if(!(this instanceof n))return new n(t);var v=/{{\s*((\w+\.?\w+?)*\s*\|?\s*\w+)\s*}}/g,g=/{{\s*#((\w+\.?\w+?)*\s*\|?\s*\w+)\s*}}/g,y=0,b={push:[],remove:[],filter:[],pushAll:[],removeAll:[]},E={upper:function(t){return t.toUpperCase()},lower:function(t){return t.toLowerCase()},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()},currency:function(t){return"$"+t},json:function(t){try{t=JSON.stringify(t)}catch(e){throw new Error("The argument passed can not be stringified to a json string")}return t}},S=t&&t.model,A=document.getElementById(t&&t.element),O=void 0,T=t&&t.template;if("string"==typeof T)O=T;else if("object"===("undefined"==typeof T?"undefined":_typeof(T))){if(!T.templateId)throw new Error('Template must be a string, or an object with "templateId" field');O=document.getElementById(T.templateId).innerHTML}if(!S)throw new Error("A model must be supplied");if(!A)throw new Error("An element must be supplied, provided by its id");if(!O)throw new Error("A template id or string must be supplied");var x=new new e({model:S});this.getCollection=function(){return x},this.models=function(){return x.toJSON()},this.updateView=f,this.pushAll=function(t){t.forEach(function(t){return x.add(new S(t))}),f(),r("pushAll",t)},this.push=function(t){u(t,"push")},this.unshift=function(t){u(t,"unshift")},this.remove=function(t){for(var e=this.models(),n=void 0,o=0;o<e.length;o++)if(n=e[o],n.index===t){x.remove(o);break}return f(),r("remove",n),e[o]},this.lastIndex=function(){return 0!==this.size()?y-1:void 0},this.firstIndex=function(){var t=this.models().map(function(t){return t.index});if(t.length){var e=1/0;return t.forEach(function(t){e>t&&(e=t)}),e}},this.removeByFields=function(t){x.removeByFields(t),f(),r("remove")},this.removeAll=function(){x.removeAll(),f(),r("removeAll")},this.get=function(t){for(var e=this.models(),n=0;n<e.length;n++){var r=e[n];if(r.index===t)return r}},this.size=function(){return x.size()},this.filter=function(t){var e=x.filterToJSON(t);return f(e),r("filter",e),e},this.sort=function(t){x.sort(t),f()},this.addFilter=function(t,e){if("string"!=typeof t)throw new Error("Filter name must be a string");if("function"!=typeof e)throw new Error("Filter callback must be a function");E[t]=e},this.save=function(){if(window.localStorage)if(2===arguments.length){var t=arguments[0],e=arguments[1];if("string"!=typeof t)throw new Error("First item must be a string");e=o(e),window.localStorage.setItem(t,e)}else{if(1!==arguments.length||"object"!==_typeof(arguments[0]))throw new Error("Method save must get key an value, or an object of keys and values");var n=arguments[0];for(var r in n){var i=n[r];i=o(i),window.localStorage.setItem(r,i)}}},this.fetch=function(t){if(window.localStorage){var e=window.localStorage.getItem(t);if(!e)throw new Error("The key "+t+" does not appear in localStorage");return i(e)}},this.clear=function(){window.localStorage&&window.localStorage.clear()},this.subscribe=function(){function t(t,e){for(var n=0;n<b[t].length;n++)if(b[t][n]===e){b[t].splice(n,1);break}}var e=arguments;if(1===arguments.length&&"function"==typeof arguments[0]){var n=function(){var n=e[0];return b.push.push(n),b.remove.push(n),{v:function(){t("push",n),t("remove",n)}}}();if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v}else{if(2!==arguments.length)throw new Error('You should pass a callback function or a type "push" or "remove" and a callback to subscribe');var r=function(){var n=e[0],r=e[1];if(b[n])return b[n].push(r),{v:function(){return t(n,r)}};throw new Error('type of listener must be "push", "remove" or "filter"')}();if("object"===("undefined"==typeof r?"undefined":_typeof(r)))return r.v}}}return Array.prototype.extend=function(t){var e=this;t.forEach(function(t){return e.push(t)})},{Model:t,List:n}}();