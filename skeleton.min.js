"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},Skeleton=function(){function e(t){function r(e){var r=Object.assign({},t.defaults)||{};this.get=function(e){return r[e]||null},this.set=function(){if(2===arguments.length)r[arguments[0]]=arguments[1];else{if(1!==arguments.length)throw new Error("Error on setting a value");var e=arguments[0];for(var t in e)r[t]=e[t]}},this.toJSON=function(){return r};for(var n in e)this.set(n,e[n]);t&&t.init&&t.init.call(this)}if(!(this instanceof e))return new e(t);if(!t||!t.defaults)throw new Error('A "defaults" field must be passed');for(var n in t)"init"!==n&&"defaults"!==n&&(r.prototype[n]=t[n]);return r}function t(e){function r(e,t){if(e){if(!S[e])throw new Error("The type passed is not a possible type");S[e].forEach(function(e){return e(t)})}else S.push.forEach(function(e){return e(t)}),S.remove.forEach(function(e){return e(t)})}function n(e,t){e instanceof T||(e=new T(e));var n=w();e.set("index",n);var o=e.toJSON();O[n]=e,i(o,t),r("push",o)}function o(e,t){var r='[data-id="'+e+'"]',n=N.querySelector(r);if(!n)throw new Error('Make sure your you set a "data-id" attribute to each model');N.replaceChild(t,n)}function i(e,t){var r=g(s(l(e),e));if("push"===t)N.appendChild(r);else{if("unshift"!==t)throw new Error('unknown method passed to "_updateSingleModelView"');N.insertBefore(r,N.childNodes[0])}}function a(e){var t='[data-id="'+e+'"]',r=N.querySelector(t);r&&r.remove()}function u(e){var t=e||I.models(),r="";return t.forEach(function(e){r+=s(l(e),e)}),r}function s(e,t){var r=void 0;"string"==typeof e&&(r=g(e));var n=r.querySelectorAll("[data-loop]");return n&&n.length?(Array.prototype.slice.call(n).forEach(function(r,n){var o=r.getAttribute("data-loop").trim(),i=t[o];if(!i)throw new Error(o+" attribute does not appear in model");if(!Array.isArray(i))throw new Error(o+"'s value must be an array");var a=y(r),u="";i.forEach(function(e){u+=a.replace(E,function(t,r){return-1!==r.indexOf("|")?f(e,r):v(e,r)})}),e=e.replace(a,u)}),e):e}function l(e){var t=j;return t=t.replace(b,function(t,r){return-1!==r.indexOf("|")?f(e,r):v(e,r)}),t=c(e,t),t=h(e,t),t=d(e,t),t=m(e,t),t=p(e,t)}function f(e,t){var r=t.split("|"),n=r[0].trim(),o=r[1].trim(),i=v(e,n);if(!i)throw new Error('Please check the expression "'+n+'" you passed in the template');if(k[o])return k[o](i);throw new Error('The filter you are using does not exist. Please use "addFilter" function to create it.')}function c(e,t){var r=g(t),n=r.querySelectorAll("[data-checked]");return n&&n.length?(Array.prototype.slice.call(n).forEach(function(t){var r=t.getAttribute("data-checked").trim(),n=e[r]?!0:!1;n?t.setAttribute("checked","checked"):t.getAttribute("checked")&&t.removeAttribute("checked")}),y(r)):t}function h(e,t){var r=g(t),n=r.querySelectorAll("[data-hide]");return n&&n.length?(Array.prototype.slice.call(n).forEach(function(t){var r=t.getAttribute("data-hide").trim(),n=e[r]?!0:!1;n?t.style.display="none":t.style.display=""}),y(r)):t}function d(e,t){var r=g(t),n=r.querySelectorAll("[data-show]");return n&&n.length?(Array.prototype.slice.call(n).forEach(function(t){var r=t.getAttribute("data-show").trim(),n=e[r]?!0:!1;n?t.style.display="":t.style.display="none"}),y(r)):t}function m(e,t){var r=g(t),n=r.querySelectorAll("[data-style]");return n&&n.length?(Array.prototype.slice.call(n).forEach(function(t){var r=t.getAttribute("data-style").trim(),n=void 0;try{n=JSON.parse(r)}catch(o){throw new Error("data-style attribute must be passed as a stringified json object")}Object.keys(n).forEach(function(r){var o=n[r].split("?");if(2!==o.length)throw new Error("data-style needs an expression to evluate");var i=o[0].trim(),a=o[1].split(":");if(2!==a.length)throw new Error("Error on data-style attribute");var u=e[i]?a[0]:a[1];t.style[r]=u})}),y(r)):t}function p(e,t){var r=g(t),n=r.querySelectorAll("[data-class]");return n&&n.length?(Array.prototype.slice.call(n).forEach(function(t){var r=t.getAttribute("data-class").trim(),n=void 0;try{n=JSON.parse(r)}catch(o){throw new Error("data-class attribute must be passed as a stringified json object")}Object.keys(n).forEach(function(r){return t.className=e[n[r].trim()]?r:""})}),y(r)):t}function v(e,t){if("this"===t)return e;var r=t.split(".");if(1===r.length)return e[t];for(var n=e[r[0].trim()],o=1;o<r.length;o++)n=n[r[o].trim()];return n}function w(){return A++}function y(e){var t=document.createElement("div");return t.appendChild(e),t.innerHTML}function g(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}if(!(this instanceof t))return new t(e);var b=/{{\s*((\w+\.?\w+?)*\s*\|?\s*\w+)\s*}}/g,E=/{{\s*#\s*((\w+\.?\w+?)*\s*\|?\s*\w+)\s*}}/g,A=0,S={push:[],remove:[],filter:[],sort:[],pushAll:[],removeAll:[],edit:[]},k={upper:function(e){return e.toUpperCase()},lower:function(e){return e.toLowerCase()},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},currency:function(e){return"$"+e},json:function(e){try{e=JSON.stringify(e)}catch(t){throw new Error("The argument passed can not be stringified to a json string")}return e}},T=e&&e.model,N=document.getElementById(e&&e.element),j=void 0,x=e&&e.template;if("string"==typeof x)j=x;else if("object"===("undefined"==typeof x?"undefined":_typeof(x))){if(!x.templateId)throw new Error('Template must be a string, or an object with "templateId" field');j=document.getElementById(x.templateId).innerHTML}if(!T)throw new Error("A model must be supplied");if(!N)throw new Error("An element must be supplied, provided by its id");if(!j)throw new Error("A template id or string must be supplied");var I=this,O={};this.getCollection=function(){return Object.keys(O).map(function(e){return O[e]})},this.models=function(){return Object.keys(O).map(function(e){return O[e].toJSON()})},this.pushAll=function(e){e.forEach(function(e){e.index=w(),O[e.index]=new T(e)}),N.innerHTML+=u(),r("pushAll",this.models())},this.push=function(e){n(e,"push")},this.unshift=function(e){n(e,"unshift")},this.remove=function(e){if(O[e]){var t=O[e];return delete O[e],a(e),r("remove",t),t}},this.lastIndex=function(){return 0===this.size()?-1:A-1},this.firstIndex=function(){var e=Object.keys(O);return e.length?Math.min.apply(null,e):-1},this.removeAll=function(){O={},N.innerHTML="",r("removeAll")},this.get=function(e){return O[e]?O[e].toJSON():null},this.size=function(){return Object.keys(O).length},this.filter=function(e){var t=this.models().filter(e);return N.innerHTML=u(t),r("filter",t),t},this.sort=function(e){e=e||function(e,t){return e.index-t.index};var t=this.models().sort(e),n={};return t.forEach(function(e){n[e.index]=O[e.index]}),O=n,N.innerHTML=u(t),r("sort",t),t},this.forEach=function(e){this.models().forEach(e)},this.edit=function(e,t){if(t){var n=O[e];for(var i in t)n.set(i,t[i]);var a=n.toJSON(),u=s(l(a),a),f=g(u);o(e,f),r("edit",a)}},this.addFilter=function(e,t){if("string"!=typeof e)throw new Error("Filter name must be a string");if("function"!=typeof t)throw new Error("Filter callback must be a function");k[e]=t},this.subscribe=function(){function e(e,t){for(var r=0;r<S[e].length;r++)if(S[e][r]===t){S[e].splice(r,1);break}}var t=arguments;if(1===arguments.length&&"function"==typeof arguments[0]){var r=function(){var r=t[0];return S.push.push(r),S.remove.push(r),{v:function(){e("push",r),e("remove",r)}}}();if("object"===("undefined"==typeof r?"undefined":_typeof(r)))return r.v}else{if(2!==arguments.length)throw new Error('You should pass a callback function or a type "push" or "remove" and a callback to subscribe');var n=function(){var r=t[0],n=t[1];if(Array.isArray(r))return r.forEach(function(e){if(!S[e])throw new Error("type "+e+' is not a possible type. possible types: "push", "remove", "filter", "sort", "edit", "pushAll", "removeAll"');S[e].push(n)}),{v:function(){return r.forEach(function(t){return e(t,n)})}};if(S[r])return S[r].push(n),{v:function(){return e(r,n)}};throw new Error("type "+r+' is not a possible type. possible types: "push", "remove", "filter", "sort", "edit", "pushAll", "removeAll"')}();if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v}}}function r(){if(!(this instanceof r))return new r;if(!window)throw new Error("I only run on the browser!");window.onpopstate=function(){return n()};var e={},t={},n=function(){var r=void 0,n=0,o=location.pathname,i=o.split("/").slice(1);for(var a in t){if(1===n)break;if(r=t[a],a=a.split(","),a.length===i.length)for(var u=0;u<a.length;u++){var s=a[u];if(":"!=s.charAt(0)){if(s===i[u]){n=1;continue}n=0,e={},r=null;break}n=1,e[s.slice(1)]=i[u]}}if(!r)throw new Error("No handler set for this route!");r.call(null,e),e={}};this.path=function(e,r){t[e.split("/").slice(1)]=r},this.visit=function(e){return history.pushState(null,null,e),n()}}function n(e){try{return e=JSON.stringify(e)}catch(t){return e}}function o(e){try{return e=JSON.parse(e)}catch(t){return e}}function i(e,t){var r=arguments.length<=2||void 0===arguments[2]?"keyup":arguments[2],n=document.getElementById(e);if(!n)throw new Error("The id '"+e+"' does not match any dom element");if("INPUT"!==n.nodeName&&"TEXTAREA"!==n.nodeName)throw new Error("The id '"+e+"' must match an input or textarea element");l[e]=n,t&&n.addEventListener(r,t)}function a(e){if(!e.name)throw new Error('Skeleton.form must recieve a "name" field with the form\'s name');var t=e.name,r=document.querySelector("form[name='"+t+"']");if(!r)throw new Error("No form element with name "+t);var n={};n.name=e.name;var o=e.inputs;if(o)for(var i in o){var a=o[i],u=r.querySelector("#"+a);if(!u)throw new Error("No element with id "+a);if("INPUT"!==u.nodeName&&"TEXTAREA"!==u.nodeName)throw new Error("The id '"+a+"' must match an input or textarea element");n[i]=u}if(!e.submit)throw new Error('"submit" button id or event key code and input field must be supplied');if(!e.onSubmit)throw new Error('"onSubmit" method must be supplied');if(f[t]=n,e.submit.input&&e.submit.keyCode)!function(){var r=e.submit.input,n=e.submit.keyCode;if(!r)throw new Error("Please supply input element to trigger submit event on by its field");if(!n)throw new Error("Please supply keyCode to fire event on");f[t][r].addEventListener("keydown",function(r){r.keyCode===n&&(r.preventDefault(),e.onSubmit.call(f[t],r))})}();else{var s=document.getElementById(e.submit);if(!s)throw new Error("Id passed as submit button id does not exist");s.addEventListener("click",function(r){r.preventDefault(),e.onSubmit.call(f[t],r)})}}function u(e){var t=document.getElementById(e);if(!t)throw new Error(e+" id does not match any element");return{to:function(){var e=Array.prototype.slice.call(arguments),r=e.map(function(e){var t=document.getElementById(e);if(!t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName)throw new Error(e+" id does not match any element or the element it matches is not input or textarea element");return t});return{exec:function(e){for(var n=arguments.length<=1||void 0===arguments[1]?"keyup":arguments[1],o=0;o<r.length;o++){var i=r[o];i.addEventListener(n,function(n){var o=r.map(function(e){var t=e.value;return t?t:""});t.textContent=e.apply(null,o)})}}}}}}var s={save:function(){if(window.localStorage)if(2===arguments.length){var e=arguments[0],t=arguments[1];if("string"!=typeof e)throw new Error("First item must be a string");t=n(t),window.localStorage.setItem(e,t)}else{if(1!==arguments.length||"object"!==_typeof(arguments[0]))throw new Error("Method save must get key an value, or an object of keys and values");var r=arguments[0];for(var o in r){var i=r[o];i=n(i),window.localStorage.setItem(o,i)}}},fetch:function(e){if(window.localStorage){var t=window.localStorage.getItem(e);return t?o(t):null}},clear:function(){window.localStorage&&window.localStorage.clear()}},l={},f={};return i.get=function(e){var t=l[e];if(!t)throw new Error("The id '"+e+"' was not set to be cached. Please use the 'input' function first");return t.value},i.set=function(e,t){var r=l[e];if(!r)throw new Error("The id '"+e+"' was not set to be cached. Please use the 'input' function first");r.value=t},i.clear=function(e){e?l[e].value="":Object.keys(l).forEach(function(e){return i.set(e,"")})},a.clear=function(e){var t=f[e];if(!t)throw new Error("The name "+e+" is not recognized as a form name");for(var r in t){var n=t[r];!n.nodeName||"INPUT"!==n.nodeName&&"TEXTAREA"!==n.nodeName||(n.value="")}},{Model:e,List:t,Router:r,storage:s,form:a,input:i,bind:u}}();